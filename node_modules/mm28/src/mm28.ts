#!/usr/bin/env node
import chalk from 'chalk';
import { program } from 'commander';
import updateNotifier from 'update-notifier';
import adminCommand from './commands/adminCommands.js';
import botCommands from './commands/botCommands.js';
import linkCommands from './commands/linkCommands.js';
import logCommands from './commands/logCommands.js';
import teamCommands from './commands/teamCommands.js';
import packageJson from './util/packageJson.js';

updateNotifier({
	pkg: packageJson,
	updateCheckInterval: 1000*30 // 30 seconds
}).notify(); // inform user if update occurs

program
	.name(packageJson.name)
	.description(packageJson.description)
	.version(packageJson.version, '-v, --version', 'print version');

// TODO: register all commands
for(const section of [
	linkCommands, teamCommands, botCommands, logCommands
]) for(const command of section) program.addCommand(command);

program.addCommand(adminCommand, {
	hidden: true
});

program.configureOutput({
	outputError(str, write) {
		write(chalk.red(str));
	}
});

program.configureHelp({
	sortOptions: true,
	sortSubcommands: false // keep in section order
});

program.addHelpText('after', '\nTry \'mm28 wiki\' to get more info, or join the discord with \'mm28 discord\' if you need help!');

program.parse();