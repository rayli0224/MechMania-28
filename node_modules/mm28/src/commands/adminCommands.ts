import { Command } from 'commander';
import apiRequest from '../util/apiRequest.js';
import { fatalErr } from '../util/messages.js';
import type { setAutoRunEndpoint, runTourneyEndpoint } from '@mm28/shared/types/api/adminApiTypes.js';
import chalk from 'chalk';

const adminCommand = new Command('admin').alias('a');

adminCommand.addCommand(new Command('setautorun')
	.argument('<autorun-bool>')
	.action(async (autorunBool) => {
		if(autorunBool !== 'true' && autorunBool !== 'false'){
			return fatalErr('You must set autorun to "true" or "false".');
		}
		const resp = await apiRequest<setAutoRunEndpoint>('PUT', '/autorun', {autorun: autorunBool});
		console.log(chalk.green(resp.body));
	})
);

adminCommand.addCommand(new Command('forcenewtourney')
	.action(async () => {
		const resp = await apiRequest<runTourneyEndpoint>('POST', '/tourneys');
		console.log(chalk.green(resp.body));
	})
);

export default adminCommand;